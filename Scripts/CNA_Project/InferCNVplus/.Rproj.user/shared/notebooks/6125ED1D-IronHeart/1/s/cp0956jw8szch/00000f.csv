"0","# MOI"
"0",""
"0","# LOADING"
"0","# Boucle pour charger et traiter chaque √©chantillon"
"0","for (sample in samples) {"
"0","  print(paste(""üì• Chargement des donn√©es pour"", sample, ""...""))"
"0","  "
"0","  # D√©finir le chemin des fichiers"
"0","  data_path <- paste0(dir_path, ""Visium/"", sample)"
"0","  "
"0","  # D√©terminer le batch en fonction du num√©ro d'√©chantillon"
"0","  sample_number <- as.numeric(gsub(""MpBC"", """", sample))"
"0","  "
"0","  ## Numero batch"
"0","  if (sample_number >= 1 & sample_number <= 8) {batch <- ""batch1""} "
"0","  else if (sample_number >= 9 & sample_number <= 16 & sample_number != 12) {batch <- ""batch2""}"
"0","  "
"0","  ## Numero slide"
"0","  if (sample_number == 1 | sample_number == 2) {slide <- ""slide1""} "
"0","  else if (sample_number == 3 | sample_number == 4) {slide <- ""slide2""}"
"0","  else if (sample_number == 5 | sample_number == 6) {slide <- ""slide3""}"
"0","  else if (sample_number == 7 | sample_number == 8) {slide <- ""slide4""}"
"0","  else if (sample_number == 9 | sample_number == 10) {slide <- ""slide5""}"
"0","  else if (sample_number == 11 | sample_number == 12) {slide <- ""slide6""}"
"0","  else if (sample_number == 13 | sample_number == 14) {slide <- ""slide7""}"
"0","  else if (sample_number == 15 | sample_number == 16) {slide <- ""slide8""}"
"0","  "
"0","  # Charger les donn√©es 10X Spatial"
"0","  obj <- Load10X_Spatial(data.dir = data_path, "
"0","                         filename = ""filtered_feature_bc_matrix.h5"", "
"0","                         assay = ""Spatial"", "
"0","                         slice = paste0(""Slice_"", sample)) %>% "
"0","    AddMetaData(metadata = batch, col.name = 'Seq_batch') %>% "
"0","    AddMetaData(metadata = slide, col.name = 'Visium_slide')"
"0","  "
"0","  # Il faut r√©ajouter les noms des dimensions, car (jsp pourquoi) ils disparaissent lors de l'importation"
"0","  # Lire la matrice de comptage"
"0","  Count_Matrix <- Read10X_h5(paste0(data_path, ""/filtered_feature_bc_matrix.h5""))"
"0","  # # Extraire les dimnames de la matrice de comptage"
"0","  dimnames_gene <- Count_Matrix@Dimnames[[1]]"
"0","  dimnames_cell <- Count_Matrix@Dimnames[[2]]"
"0","  # # Affecter ces dimnames √† la couche ""counts"" de l'assay ""Spatial"""
"0","  dimnames_gene -> obj@assays[[""Spatial""]]@layers[[""counts""]]@Dimnames[[1]] "
"0","  dimnames_cell -> obj@assays[[""Spatial""]]@layers[[""counts""]]@Dimnames[[2]]"
"0",""
"0","  "
"0","  # Charger les annotations"
"0","  annotation_new <- read.csv(paste0(data_path, ""/Annotations_new_with_unlabels.csv"")) %>%"
"0","    mutate(Barcode = paste0(sample, ""_"", Barcode))"
"0","  "
"0","  annotation_old <- read.csv(paste0(data_path, ""/Annotations_old_with_unlabels.csv"")) %>%"
"0","    mutate(Barcode = paste0(sample, ""_"", Barcode)) %>%"
"0","    rename(""Barcode_new"" = Barcode)"
"0","  "
"0","  # Ajouter les annotations √† meta.data"
"0","  obj@meta.data <- obj@meta.data %>%"
"0","    cbind(annotation_new, annotation_old) %>%"
"0","    select(-Barcode_new) %>%"
"0","    rename(""Patient"" = orig.ident) %>%"
"0","    mutate(Patient = sample)"
"0",""
"0","  obj <- subset(obj,"
"0","                subset = (nCount_Spatial > 0 &"
"0","                          Annotations_old != """" & Annotations_old != ""Adipose"" &"
"0","                          Annotations_old != ""Artifacts"" & Annotations_old != ""Immune cells"" &"
"0","                          Annotations_old != ""Intermediate tumour cells"" & Annotations_old != ""Mixed cells"" &"
"0","                          Annotations_old != ""Necrosis"" & Annotations_old != ""Necrotic and apoptotic tissue"" &"
"0","                          Annotations_old != ""NST surrounded by spindle"" & Annotations_old != ""Scar-like fibrous stroma"" &"
"0","                          Annotations_new != ""Pleiomorphic tumor""))"
"0","  "
"0","  # Convertir les donn√©es dans orig.ident en facteur"
"0","  obj$Seq_batch <- as.factor(obj$Seq_batch)"
"0","  obj$Visium_slide <- factor(obj$Visium_slide)"
"0","  "
"0","  # Sauvegarder l'objet dans l'environnement sous le nom ""MpBCX"""
"0","  assign(sample, obj)"
"0","  "
"0","  # On fait le propre"
"0","  rm(annotation_old, annotation_new, obj)"
"0","  "
"0","  "
"0","  "
"0","  "
"0","  print(paste(""‚úÖ Donn√©es charg√©es pour"", sample))"
"0",""
"0","}"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC1 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC1"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC2 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC2"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC3 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC3"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC4 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC4"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC5 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC5"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC6 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC6"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC7 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC7"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC8 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC8"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC9 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC9"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC10 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC10"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC11 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC11"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC13 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC13"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC14 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC14"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC15 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC15"""
"1","
"
"1","[1]"
"1"," ""üì• Chargement des donn√©es pour MpBC16 ..."""
"1","
"
"1","[1]"
"1"," ""‚úÖ Donn√©es charg√©es pour MpBC16"""
"1","
"
"0","# On change samples pour qu'il contienne les objets Seurat en eux-m√™me (plut√¥t que les noms des objets (charcters))"
"0","samples <- list(MpBC1, MpBC2, MpBC3, MpBC4, MpBC5, MpBC6, MpBC7, MpBC8, MpBC9, MpBC10, MpBC11, MpBC13, MpBC14, MpBC15, MpBC16)"
"0","names(samples) <- c(""MpBC1"", ""MpBC2"", ""MpBC3"", ""MpBC4"", ""MpBC5"", ""MpBC6"", ""MpBC7"", ""MpBC8"", ""MpBC9"", ""MpBC10"", ""MpBC11"", ""MpBC13"", ""MpBC14"", ""MpBC15"", ""MpBC16"")"
"0","samples_names <- names(samples)"
"0","  "
"0","  "
"0","print(""üéâ Tous les √©chantillons ont √©t√© trait√©s avec succ√®s !"")"
"1","[1]"
"1"," ""üéâ Tous les √©chantillons ont √©t√© trait√©s avec succ√®s !"""
"1","
"
