"0","# Nombre de features à conserver"
"0","# features_number <- 2000"
"0",""
"0","# Liste des échantillons à traiter (excluant MpBC12)"
"0","samples <- paste0(""MpBC"", c(1:11, 13:16))"
"0",""
"0","# Boucle pour charger et traiter chaque échantillon"
"0","for (sample in samples) {"
"0","  print(paste(""📥 Chargement des données pour"", sample, ""...""))"
"0","  "
"0","  # Définir le chemin des fichiers"
"0","  data_path <- paste0(dir_path, ""Visium/"", sample)"
"0","  "
"0","  # Déterminer le batch en fonction du numéro d'échantillon"
"0","  sample_number <- as.numeric(gsub(""MpBC"", """", sample))"
"0","  "
"0","  ## Numero batch"
"0","  if (sample_number >= 1 & sample_number <= 8) {batch <- ""batch1""} "
"0","  else if (sample_number >= 9 & sample_number <= 16 & sample_number != 12) {batch <- ""batch2""}"
"0","  "
"0","  ## Numero slide"
"0","  if (sample_number == 1 | sample_number == 2) {slide <- ""slide1""} "
"0","  else if (sample_number == 3 | sample_number == 4) {slide <- ""slide2""}"
"0","  else if (sample_number == 5 | sample_number == 6) {slide <- ""slide3""}"
"0","  else if (sample_number == 7 | sample_number == 8) {slide <- ""slide4""}"
"0","  else if (sample_number == 9 | sample_number == 10) {slide <- ""slide5""}"
"0","  else if (sample_number == 11 | sample_number == 12) {slide <- ""slide6""}"
"0","  else if (sample_number == 13 | sample_number == 14) {slide <- ""slide7""}"
"0","  else if (sample_number == 15 | sample_number == 16) {slide <- ""slide8""}"
"0","  "
"0","  # Charger les données 10X Spatial"
"0","  obj <- Load10X_Spatial(data.dir = data_path, "
"0","                         filename = ""filtered_feature_bc_matrix.h5"", "
"0","                         assay = ""Spatial"", slice = paste0(""Slice_"", sample)) %>% "
"0","    AddMetaData(metadata = batch, col.name = 'Seq_batch') %>% "
"0","    AddMetaData(metadata = slide, col.name = 'Visium_slide')"
"0","  "
"0","  # Charger les annotations"
"0","  annotation_new <- read.csv(paste0(data_path, ""/Annotations_new_with_unlabels.csv"")) %>%"
"0","    mutate(Barcode = paste0(sample, ""_"", Barcode))"
"0","  "
"0","  annotation_old <- read.csv(paste0(data_path, ""/Annotations_old_with_unlabels.csv"")) %>%"
"0","    mutate(Barcode = paste0(sample, ""_"", Barcode)) %>%"
"0","    rename(""Barcode_new"" = Barcode)"
"0","  "
"0","  # Ajouter les annotations à meta.data"
"0","  obj@meta.data <- obj@meta.data %>%"
"0","    cbind(annotation_new, annotation_old) %>%"
"0","    select(-Barcode_new) %>%"
"0","    rename(""Patient"" = orig.ident) %>%"
"0","    mutate(Patient = sample)"
"0",""
"0","  # On enlève certains types cellulaires (difficilement caractérisables)"
"0","  obj <- obj %>%"
"0","    subset(nCount_Spatial > 0 &"
"0","           Annotations_old != ""Mixed cells"" &"
"0","           Annotations_new != ""Pleiomorphic tumor"" &"
"0","           Annotations_old != ""NST surrounded by spindle"" &"
"0","           Annotations_old != """" & Annotations_new != """" &"
"0","           Annotations_old != ""Necrosis"" & Annotations_new != ""Necrosis"")"
"0",""
"0","  # Normaliser les données "
"0","  ## --- NormalizeData ---"
"0","  # obj <- obj %>% NormalizeData(assay = ""Spatial"","
"0","  #                              normalization.method = ""LogNormalize"","
"0","  #                              scale.factor = 5000) %>%"
"0","  # FindVariableFeatures(selection.method = ""vst"","
"0","  #                      nfeatures = 750) %>%"
"0","  # ScaleData(do.scale = TRUE,"
"0","  #           do.center = TRUE,"
"0","  #           scale.max = 50,"
"0","  #           model.use = ""linear"")"
"0","  ## --- SCTransform ---"
"0","  # obj <- obj %>% SCTransform(vst.flavor = ""v2"","
"0","  #                            assay = ""Spatial"", "
"0","  #                            do.scale = FALSE, "
"0","  #                            do.center = TRUE, "
"0","  #                            verbose = TRUE,"
"0","  #                            return.only.var.genes = TRUE,"
"0","  #                            variable.features.n = features_number,"
"0","  #                            n_genes = features_number)"
"0","  "
"0","  "
"0","  # Sauvegarder l'objet dans l'environnement sous le nom ""MpBCX"""
"0","  assign(sample, obj)"
"0","  "
"0","  print(paste(""✅ Données chargées pour"", sample))"
"0",""
"0","}"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC1 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC1"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC2 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC2"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC3 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC3"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC4 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC4"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC5 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC5"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC6 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC6"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC7 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC7"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC8 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC8"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC9 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC9"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC10 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC10"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC11 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC11"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC13 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC13"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC14 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC14"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC15 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC15"""
"1","
"
"1","[1]"
"1"," ""📥 Chargement des données pour MpBC16 ..."""
"1","
"
"1","[1]"
"1"," ""✅ Données chargées pour MpBC16"""
"1","
"
"0","print(""🎉 Tous les échantillons ont été traités avec succès !"")"
"1","[1]"
"1"," ""🎉 Tous les échantillons ont été traités avec succès !"""
"1","
"
